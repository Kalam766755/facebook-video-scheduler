<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Facebook Video Scheduler</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; background-color: #f3f4f6; line-height: 1.6; }
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        .card { background: white; border-radius: 8px; padding: 20px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); margin-bottom: 20px; }
        .btn { background: #4f46e5; color: white; padding: 10px 15px; border: none; border-radius: 4px; cursor: pointer; transition: background 0.2s; font-size: 14px; }
        .btn:hover { background: #4338ca; }
        .btn:disabled { background: #9ca3af; cursor: not-allowed; }
        .btn-danger { background: #dc2626; }
        .btn-danger:hover { background: #b91c1c; }
        .btn-secondary { background: #6b7280; }
        .btn-secondary:hover { background: #4b5563; }
        .btn-success { background: #16a34a; }
        .btn-success:hover { background: #15803d; }
        .form-group { margin-bottom: 15px; }
        .form-label { display: block; margin-bottom: 5px; font-weight: 500; color: #374151; }
        .form-input, .form-select, .form-textarea { width: 100%; padding: 8px 12px; border: 1px solid #d1d5db; border-radius: 6px; font-size: 14px; }
        .form-input:focus, .form-select:focus, .form-textarea:focus { outline: none; border-color: #4f46e5; box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1); }
        .nav { display: flex; gap: 0; margin-bottom: 20px; border-bottom: 1px solid #e5e7eb; flex-wrap: wrap; }
        .nav-item { padding: 12px 20px; cursor: pointer; border-bottom: 2px solid transparent; white-space: nowrap; }
        .nav-item.active { border-bottom-color: #4f46e5; color: #4f46e5; font-weight: 500; }
        .error-message { background: #fef2f2; color: #dc2626; padding: 12px; border-radius: 6px; margin-bottom: 15px; border: 1px solid #fecaca; }
        .success-message { background: #f0fdf4; color: #16a34a; padding: 12px; border-radius: 6px; margin-bottom: 15px; border: 1px solid #bbf7d0; }
        .info-message { background: #dbeafe; color: #1e40af; padding: 12px; border-radius: 6px; margin-bottom: 15px; border: 1px solid #bfdbfe; }
        .flex { display: flex; }
        .items-center { align-items: center; }
        .justify-between { justify-content: space-between; }
        .gap-2 { gap: 8px; }
        .gap-4 { gap: 16px; }
        .grid { display: grid; }
        .grid-cols-1 { grid-template-columns: repeat(1, minmax(0, 1fr)); }
        .grid-cols-2 { grid-template-columns: repeat(2, minmax(0, 1fr)); }
        .gap-4 { gap: 16px; }
        .mt-4 { margin-top: 16px; }
        .mb-4 { margin-bottom: 16px; }
        .text-center { text-align: center; }
        .text-sm { font-size: 14px; }
        .text-xs { font-size: 12px; }
        .divide-y > :not([hidden]) ~ :not([hidden]) { border-top-width: 1px; border-color: #e5e7eb; }
        .hidden { display: none; }
        .w-full { width: 100%; }
        .max-w-md { max-width: 28rem; }
        .min-h-screen { min-height: 100vh; }
        .items-center { align-items: center; }
        .justify-center { justify-content: center; }
        .space-y-4 > * + * { margin-top: 16px; }
        .space-y-6 > * + * { margin-top: 24px; }
        @media (min-width: 768px) {
            .md\:grid-cols-2 { grid-template-columns: repeat(2, minmax(0, 1fr)); }
            .md\:flex { display: flex; }
        }
        .upload-zone { border: 2px dashed #d1d5db; padding: 40px; text-align: center; border-radius: 8px; cursor: pointer; transition: border-color 0.2s; }
        .upload-zone:hover { border-color: #4f46e5; }
        .status-badge { display: inline-block; padding: 4px 8px; border-radius: 9999px; font-size: 12px; font-weight: 500; }
        .status-scheduled { background: #fef3c7; color: #d97706; }
        .status-posted { background: #dcfce7; color: #16a34a; }
        .status-failed { background: #fee2e2; color: #dc2626; }
        .animate-spin { animation: spin 1s linear infinite; }
        @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        // Auth Context
        const AuthContext = React.createContext();
        const BACKEND_URL = 'https://facebook-video-scheduler-jaxg.onrender.com';
        
        // Set axios base URL and default headers
        axios.defaults.baseURL = BACKEND_URL;

        // Main App Component
        function App() {
            const [currentUser, setCurrentUser] = React.useState(null);
            const [page, setPage] = React.useState('login');
            const [loading, setLoading] = React.useState(false);
            const [backendStatus, setBackendStatus] = React.useState('checking');

            React.useEffect(() => {
                const token = localStorage.getItem('token');
                const user = localStorage.getItem('user');
                
                // Check backend status
                checkBackendStatus();
                
                if (token && user) {
                    setCurrentUser(JSON.parse(user));
                    setPage('dashboard');
                    axios.defaults.headers.common['Authorization'] = `Bearer ${token}`;
                }
                
                // Periodically check backend status
                const interval = setInterval(checkBackendStatus, 30000);
                return () => clearInterval(interval);
            }, []);

            const checkBackendStatus = async () => {
                try {
                    await axios.get('/api/auth/health');
                    setBackendStatus('online');
                } catch (error) {
                    setBackendStatus('offline');
                }
            };

            const login = async (email, password) => {
                try {
                    setLoading(true);
                    const response = await axios.post('/api/auth/login', { email, password });
                    
                    const { token, user } = response.data;
                    localStorage.setItem('token', token);
                    localStorage.setItem('user', JSON.stringify(user));
                    axios.defaults.headers.common['Authorization'] = `Bearer ${token}`;
                    setCurrentUser(user);
                    setPage('dashboard');
                    
                    return { success: true };
                } catch (error) {
                    return { 
                        success: false, 
                        message: error.response?.data?.message || 'Login failed. Please check your credentials.' 
                    };
                } finally {
                    setLoading(false);
                }
            };

            const register = async (email, password, confirmPassword) => {
                if (password !== confirmPassword) {
                    return { success: false, message: 'Passwords do not match' };
                }

                try {
                    setLoading(true);
                    const response = await axios.post('/api/auth/register', { email, password });
                    
                    const { token, user } = response.data;
                    localStorage.setItem('token', token);
                    localStorage.setItem('user', JSON.stringify(user));
                    axios.defaults.headers.common['Authorization'] = `Bearer ${token}`;
                    setCurrentUser(user);
                    setPage('dashboard');
                    
                    return { success: true };
                } catch (error) {
                    return { 
                        success: false, 
                        message: error.response?.data?.message || 'Registration failed. Please try again.' 
                    };
                } finally {
                    setLoading(false);
                }
            };

            const logout = () => {
                localStorage.removeItem('token');
                localStorage.removeItem('user');
                delete axios.defaults.headers.common['Authorization'];
                setCurrentUser(null);
                setPage('login');
            };

            return (
                <AuthContext.Provider value={{ 
                    currentUser, 
                    login, 
                    register, 
                    logout, 
                    loading, 
                    backendStatus,
                    setLoading 
                }}>
                    <div className="container">
                        {page === 'login' && <LoginPage onLogin={() => setPage('dashboard')} onSwitch={() => setPage('register')} />}
                        {page === 'register' && <RegisterPage onRegister={() => setPage('dashboard')} onSwitch={() => setPage('login')} />}
                        {page === 'dashboard' && <DashboardPage onLogout={logout} />}
                    </div>
                </AuthContext.Provider>
            );
        }

        // Login Component
        function LoginPage({ onLogin, onSwitch }) {
            const [email, setEmail] = React.useState('');
            const [password, setPassword] = React.useState('');
            const [error, setError] = React.useState('');
            
            const { login, loading, backendStatus } = React.useContext(AuthContext);

            const handleSubmit = async (e) => {
                e.preventDefault();
                setError('');
                
                const result = await login(email, password);
                
                if (result.success) {
                    onLogin();
                } else {
                    setError(result.message);
                }
            };

            return (
                <div className="card" style={{ maxWidth: '400px', margin: '50px auto' }}>
                    <h2 style={{ textAlign: 'center', marginBottom: '20px' }}>Login to Your Account</h2>
                    
                    <div className={backendStatus === 'online' ? 'success-message' : 'error-message'}>
                        Backend Status: {backendStatus === 'online' ? '✅ Online' : '❌ Offline - Please check your backend deployment'}
                    </div>
                    
                    {error && <div className="error-message">{error}</div>}
                    
                    <form onSubmit={handleSubmit} className="space-y-4">
                        <div className="form-group">
                            <label className="form-label">Email Address</label>
                            <input
                                type="email"
                                className="form-input"
                                value={email}
                                onChange={(e) => setEmail(e.target.value)}
                                required
                                placeholder="Enter your email"
                                disabled={backendStatus === 'offline'}
                            />
                        </div>
                        
                        <div className="form-group">
                            <label className="form-label">Password</label>
                            <input
                                type="password"
                                className="form-input"
                                value={password}
                                onChange={(e) => setPassword(e.target.value)}
                                required
                                placeholder="Enter your password"
                                disabled={backendStatus === 'offline'}
                            />
                        </div>
                        
                        <button 
                            type="submit" 
                            className="btn w-full" 
                            disabled={loading || backendStatus === 'offline'}
                        >
                            {loading ? 'Logging in...' : 'Sign In'}
                        </button>
                    </form>
                    
                    <p style={{ textAlign: 'center', marginTop: '15px' }}>
                        Don't have an account?{' '}
                        <a href="#" onClick={onSwitch} style={{ color: '#4f46e5', textDecoration: 'none' }}>
                            Sign up
                        </a>
                    </p>
                </div>
            );
        }

        // Register Component
        function RegisterPage({ onRegister, onSwitch }) {
            const [email, setEmail] = React.useState('');
            const [password, setPassword] = React.useState('');
            const [confirmPassword, setConfirmPassword] = React.useState('');
            const [error, setError] = React.useState('');
            
            const { register, loading, backendStatus } = React.useContext(AuthContext);

            const handleSubmit = async (e) => {
                e.preventDefault();
                setError('');
                
                const result = await register(email, password, confirmPassword);
                
                if (result.success) {
                    onRegister();
                } else {
                    setError(result.message);
                }
            };

            return (
                <div className="card" style={{ maxWidth: '400px', margin: '50px auto' }}>
                    <h2 style={{ textAlign: 'center', marginBottom: '20px' }}>Create Your Account</h2>
                    
                    <div className={backendStatus === 'online' ? 'success-message' : 'error-message'}>
                        Backend Status: {backendStatus === 'online' ? '✅ Online' : '❌ Offline - Please check your backend deployment'}
                    </div>
                    
                    {error && <div className="error-message">{error}</div>}
                    
                    <form onSubmit={handleSubmit} className="space-y-4">
                        <div className="form-group">
                            <label className="form-label">Email Address</label>
                            <input
                                type="email"
                                className="form-input"
                                value={email}
                                onChange={(e) => setEmail(e.target.value)}
                                required
                                placeholder="Enter your email"
                                disabled={backendStatus === 'offline'}
                            />
                        </div>
                        
                        <div className="form-group">
                            <label className="form-label">Password</label>
                            <input
                                type="password"
                                className="form-input"
                                value={password}
                                onChange={(e) => setPassword(e.target.value)}
                                required
                                placeholder="Create a password"
                                disabled={backendStatus === 'offline'}
                            />
                        </div>
                        
                        <div className="form-group">
                            <label className="form-label">Confirm Password</label>
                            <input
                                type="password"
                                className="form-input"
                                value={confirmPassword}
                                onChange={(e) => setConfirmPassword(e.target.value)}
                                required
                                placeholder="Confirm your password"
                                disabled={backendStatus === 'offline'}
                            />
                        </div>
                        
                        <button 
                            type="submit" 
                            className="btn w-full" 
                            disabled={loading || backendStatus === 'offline'}
                        >
                            {loading ? 'Creating Account...' : 'Sign Up'}
                        </button>
                    </form>
                    
                    <p style={{ textAlign: 'center', marginTop: '15px' }}>
                        Already have an account?{' '}
                        <a href="#" onClick={onSwitch} style={{ color: '#4f46e5', textDecoration: 'none' }}>
                            Sign in
                        </a>
                    </p>
                </div>
            );
        }

        // Dashboard Component
        function DashboardPage({ onLogout }) {
            const { currentUser, backendStatus } = React.useContext(AuthContext);
            const [activeTab, setActiveTab] = React.useState('accounts');
            const [accounts, setAccounts] = React.useState([]);
            const [pages, setPages] = React.useState([]);
            const [uploads, setUploads] = React.useState([]);
            const [posts, setPosts] = React.useState([]);
            const [loading, setLoading] = React.useState(false);
            const [error, setError] = React.useState('');
            const [success, setSuccess] = React.useState('');

            React.useEffect(() => {
                if (currentUser) {
                    fetchData();
                }
            }, [currentUser, activeTab]);

            const fetchData = async () => {
                try {
                    setLoading(true);
                    
                    if (activeTab === 'accounts') {
                        const response = await axios.get('/api/accounts');
                        setAccounts(response.data);
                    }
                    else if (activeTab === 'pages') {
                        const response = await axios.get('/api/pages');
                        setPages(response.data);
                    }
                    else if (activeTab === 'upload') {
                        const response = await axios.get('/api/upload');
                        setUploads(response.data);
                    }
                    else if (activeTab === 'history') {
                        const response = await axios.get('/api/posts');
                        setPosts(response.data);
                    }
                } catch (error) {
                    setError('Failed to fetch data: ' + (error.response?.data?.message || error.message));
                } finally {
                    setLoading(false);
                }
            };

            const clearMessages = () => {
                setError('');
                setSuccess('');
            };

            return (
                <div>
                    <header className="card" style={{ marginBottom: '20px' }}>
                        <div className="flex justify-between items-center">
                            <h1 style={{ margin: 0 }}>Facebook Video Scheduler</h1>
                            <div className="flex items-center gap-4">
                                <span className={`status-badge ${backendStatus === 'online' ? 'status-posted' : 'status-failed'}`}>
                                    {backendStatus === 'online' ? '✅ Online' : '❌ Offline'}
                                </span>
                                <span>Welcome, {currentUser?.email}</span>
                                <button onClick={onLogout} className="btn btn-danger">Logout</button>
                            </div>
                        </div>
                    </header>

                    <div className="nav">
                        {['accounts', 'pages', 'upload', 'post', 'history'].map(tab => (
                            <div
                                key={tab}
                                className={`nav-item ${activeTab === tab ? 'active' : ''}`}
                                onClick={() => { setActiveTab(tab); clearMessages(); }}
                            >
                                {tab.charAt(0).toUpperCase() + tab.slice(1)}
                            </div>
                        ))}
                    </div>

                    <div className="card">
                        {error && <div className="error-message">{error}</div>}
                        {success && <div className="success-message">{success}</div>}
                        
                        {backendStatus === 'offline' && (
                            <div className="error-message">
                                <strong>Backend is offline.</strong> Please check your backend deployment on Render.com.
                                Your backend URL: <code>https://facebook-video-scheduler-jaxg.onrender.com</code>
                            </div>
                        )}
                        
                        <h2 style={{ marginBottom: '20px' }}>{activeTab.charAt(0).toUpperCase() + activeTab.slice(1)} Management</h2>
                        
                        {loading && <div style={{ textAlign: 'center', padding: '20px' }}>Loading...</div>}
                        
                        {activeTab === 'accounts' && <AccountsTab accounts={accounts} onUpdate={fetchData} />}
                        {activeTab === 'pages' && <PagesTab pages={pages} onUpdate={fetchData} />}
                        {activeTab === 'upload' && <UploadTab uploads={uploads} onUpdate={fetchData} />}
                        {activeTab === 'post' && <PostTab accounts={accounts} pages={pages} uploads={uploads} onUpdate={fetchData} />}
                        {activeTab === 'history' && <HistoryTab posts={posts} onUpdate={fetchData} />}
                    </div>
                </div>
            );
        }

        // Accounts Tab Component
        function AccountsTab({ accounts, onUpdate }) {
            const [name, setName] = React.useState('');
            const [editingId, setEditingId] = React.useState(null);
            const [loading, setLoading] = React.useState(false);
            const { setLoading: setGlobalLoading } = React.useContext(AuthContext);

            const handleSubmit = async (e) => {
                e.preventDefault();
                if (!name.trim()) return;
                
                setLoading(true);
                setGlobalLoading(true);
                
                try {
                    if (editingId) {
                        await axios.put(`/api/accounts/${editingId}`, { name });
                    } else {
                        await axios.post('/api/accounts', { name });
                    }
                    
                    setName('');
                    setEditingId(null);
                    onUpdate();
                } catch (error) {
                    alert(error.response?.data?.message || 'Failed to save account');
                } finally {
                    setLoading(false);
                    setGlobalLoading(false);
                }
            };

            const handleEdit = (account) => {
                setName(account.name);
                setEditingId(account._id);
            };

            const handleDelete = async (id) => {
                if (!confirm('Are you sure you want to delete this account?')) return;
                
                setGlobalLoading(true);
                try {
                    await axios.delete(`/api/accounts/${id}`);
                    onUpdate();
                } catch (error) {
                    alert(error.response?.data?.message || 'Failed to delete account');
                } finally {
                    setGlobalLoading(false);
                }
            };

            return (
                <div>
                    <p>Manage your Facebook accounts (maximum 5 accounts allowed).</p>
                    
                    <form onSubmit={handleSubmit} className="mt-4 space-y-4">
                        <div className="form-group">
                            <label className="form-label">Account Name</label>
                            <input
                                type="text"
                                className="form-input"
                                value={name}
                                onChange={(e) => setName(e.target.value)}
                                placeholder="Enter account name"
                                required
                            />
                        </div>
                        
                        <div className="flex gap-2">
                            <button type="submit" className="btn" disabled={loading}>
                                {loading ? 'Saving...' : editingId ? 'Update Account' : 'Add Account'}
                            </button>
                            
                            {editingId && (
                                <button type="button" onClick={() => { setEditingId(null); setName(''); }} className="btn btn-secondary">
                                    Cancel
                                </button>
                            )}
                        </div>
                    </form>
                    
                    <div className="mt-6">
                        <h3 className="form-label">Your Accounts ({accounts.length}/5)</h3>
                        
                        {accounts.length === 0 ? (
                            <p style={{ padding: '20px', textAlign: 'center', color: '#6b7280' }}>
                                No accounts added yet.
                            </p>
                        ) : (
                            <div className="divide-y">
                                {accounts.map(account => (
                                    <div key={account._id} className="py-3 flex justify-between items-center">
                                        <span>{account.name}</span>
                                        <div className="flex gap-2">
                                            <button onClick={() => handleEdit(account)} className="text-sm text-blue-600">
                                                Edit
                                            </button>
                                            <button onClick={() => handleDelete(account._id)} className="text-sm text-red-600">
                                                Delete
                                            </button>
                                        </div>
                                    </div>
                                ))}
                            </div>
                        )}
                    </div>
                </div>
            );
        }

        // Other tabs would be implemented similarly...
        // For brevity, I'll show simplified versions of the other tabs

        function PagesTab({ pages, onUpdate }) {
            return (
                <div>
                    <p>Manage your Facebook pages (maximum 10 pages per account).</p>
                    <div className="mt-4 p-4 bg-gray-50 rounded-lg text-center">
                        <p>Pages management functionality would be implemented here.</p>
                        <p className="text-sm text-gray-600">Connected to your backend at: https://facebook-video-scheduler-jaxg.onrender.com</p>
                    </div>
                </div>
            );
        }

        function UploadTab({ uploads, onUpdate }) {
            return (
                <div>
                    <p>Upload videos to schedule on your Facebook pages.</p>
                    <div className="mt-4 p-4 bg-gray-50 rounded-lg text-center">
                        <p>Video upload functionality would be implemented here.</p>
                        <p className="text-sm text-gray-600">Connected to your backend at: https://facebook-video-scheduler-jaxg.onrender.com</p>
                    </div>
                </div>
            );
        }

        function PostTab({ accounts, pages, uploads, onUpdate }) {
            return (
                <div>
                    <p>Schedule posts to your Facebook pages.</p>
                    <div className="mt-4 p-4 bg-gray-50 rounded-lg text-center">
                        <p>Post scheduling functionality would be implemented here.</p>
                        <p className="text-sm text-gray-600">Connected to your backend at: https://facebook-video-scheduler-jaxg.onrender.com</p>
                    </div>
                </div>
            );
        }

        function HistoryTab({ posts, onUpdate }) {
            return (
                <div>
                    <p>View your posting history and scheduled posts.</p>
                    <div className="mt-4 p-4 bg-gray-50 rounded-lg text-center">
                        <p>Post history functionality would be implemented here.</p>
                        <p className="text-sm text-gray-600">Connected to your backend at: https://facebook-video-scheduler-jaxg.onrender.com</p>
                    </div>
                </div>
            );
        }

        // Render the App
        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>